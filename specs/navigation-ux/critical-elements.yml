# Critical Elements Testing Specification
# Validates presence and functionality of critical page elements

metadata:
  category: "navigation-ux"
  version: "1.0.0"
  description: "Validates critical page elements are present and functional"
  priority: "critical"
  dependencies: ["test-helpers", "site-loader", "wordpress-page-objects"]
  tags:
    - "critical-elements"
    - "page-structure"
    - "user-experience"

configuration:
  timeout: 20000
  retries: 2
  parallel: true
  browsers: ["chrome", "firefox", "safari"]

test_cases:
  - name: "site_wide_critical_elements"
    description: "Validate elements that should be present across all pages"
    priority: "critical"
    reporting:
      epic: "Navigation & UX"
      feature: "Critical Site Elements"
      story: "As a user, I want consistent site elements on all pages"
      severity: "critical"
    
    execution:
      for_each_page: "{{siteConfig.testPages}}"
      conditions:
        - response_status: 200
      steps:
        - action: "navigate_safely"
          target: "{{baseUrl}}{{currentPage}}"
          description: "Navigate to {{currentPage}}"
        
        - action: "validate_header_elements"
          elements:
            - selector: "header, .header, .site-header"
              required: true
              description: "Main site header"
            - selector: "nav, .main-navigation, .primary-menu"
              required: true
              description: "Primary navigation"
            - selector: "[alt*='logo'], .logo, .site-logo"
              required: false  # Not all sites have logos
              description: "Site logo or branding"
          description: "Verify header elements are present"
        
        - action: "validate_footer_elements"
          elements:
            - selector: "footer, .footer, .site-footer"
              required: true
              description: "Main site footer"
            - selector: "footer a, .footer a"
              min_count: 1
              description: "Footer contains links"
          description: "Verify footer elements are present"
        
        - action: "validate_content_area"
          elements:
            - selector: "main, .main, .content, #content"
              required: true
              description: "Main content area"
            - selector: "h1, .page-title, .entry-title"
              required: true
              description: "Page heading"
          description: "Verify main content structure"

  - name: "page_specific_critical_elements"
    description: "Validate elements specific to different page types"
    priority: "high"
    reporting:
      epic: "Navigation & UX"
      feature: "Page-Specific Elements"
      story: "As a user, I want page-specific elements to be functional"
      severity: "normal"
    
    execution:
      dynamic_validation: true  # Use site config to determine which checks to run
      steps:
        - action: "validate_homepage_elements"
          if: "currentPage === '/'"
          elements:
            - selector: ".hero, .banner, .intro"
              required: false
              description: "Hero/banner section"
            - selector: ".call-to-action, .cta"
              required: false
              description: "Call-to-action elements"
          description: "Validate homepage-specific elements"
        
        - action: "validate_contact_page_elements"
          if: "currentPage.includes('contact')"
          elements:
            - selector: "form, .contact-form, .wpcf7-form"
              required: true
              description: "Contact form"
            - selector: "input[type='email'], input[name*='email']"
              required: true
              description: "Email input field"
          description: "Validate contact page elements"
        
        - action: "validate_blog_elements"
          if: "currentPage.includes('blog') || currentPage.includes('news')"
          elements:
            - selector: ".post, .entry, article"
              min_count: 1
              description: "Blog post entries"
            - selector: ".post-title, .entry-title"
              min_count: 1
              description: "Post titles"
          description: "Validate blog page elements"

  - name: "wordpress_theme_elements"
    description: "Validate WordPress theme-specific critical elements"
    priority: "medium"
    reporting:
      epic: "Navigation & UX"
      feature: "WordPress Theme Elements"
      story: "As a developer, I want theme elements to render correctly"
      severity: "normal"
    
    execution:
      sample_pages: 3  # Test representative sample
      steps:
        - action: "detect_wordpress_theme"
          methods:
            - "body_class_analysis"
            - "stylesheet_detection"
            - "theme_metadata"
          description: "Identify active WordPress theme"
        
        - action: "validate_theme_elements"
          elements:
            - selector: ".wp-block, [class*='wp-block']"
              required: false
              description: "Gutenberg blocks (if using block theme)"
            - selector: ".widget, .sidebar"
              required: false
              description: "Sidebar widgets"
            - selector: ".wp-caption, .alignleft, .alignright"
              required: false
              description: "WordPress content styling classes"
          description: "Validate WordPress theme-specific elements"
        
        - action: "check_responsive_elements"
          viewports: ["desktop", "tablet", "mobile"]
          elements:
            - ".mobile-menu, .hamburger"
            - ".responsive-navigation"
            - ".mobile-toggle"
          description: "Verify responsive design elements"

  - name: "accessibility_critical_elements"
    description: "Validate critical accessibility elements"
    priority: "high"
    reporting:
      epic: "Navigation & UX"
      feature: "Accessibility Elements"
      story: "As a user with disabilities, I want accessible navigation"
      severity: "normal"
    
    execution:
      for_each_page: "{{siteConfig.testPages}}"
      limit: 5  # Test representative sample
      steps:
        - action: "validate_semantic_structure"
          elements:
            - selector: "nav[role='navigation'], nav"
              aria_attributes: ["aria-label", "aria-labelledby"]
              description: "Semantic navigation"
            - selector: "main[role='main'], main"
              required: true
              description: "Main content landmark"
            - selector: "header[role='banner'], header"
              required: true
              description: "Page header landmark"
          description: "Verify semantic HTML structure"
        
        - action: "validate_skip_links"
          elements:
            - selector: "a[href='#content'], a[href='#main']"
              required: false  # Recommended but not required
              description: "Skip to content links"
          description: "Check for accessibility skip links"
        
        - action: "validate_focus_management"
          checks:
            - tab_order_logical: true
            - focus_indicators_visible: true
            - no_focus_traps: true
          description: "Verify focus management and keyboard navigation"

assertions:
  critical:
    - "Header and footer elements are present on all pages"
    - "Main content area is properly structured"
    - "Navigation elements are accessible"
    - "Contact forms are present on contact pages"
  
  normal:
    - "Page-specific elements are appropriate"
    - "WordPress theme elements render correctly"
    - "Responsive elements function properly"
  
  minor:
    - "Accessibility landmarks are properly implemented"
    - "Skip links are available where appropriate"
    - "Theme-specific styling is applied correctly"

error_handling:
  soft_assertions: true
  screenshot_on_failure: true
  missing_element_handling:
    - log_missing_elements: true
    - continue_with_remaining: true
    - suggest_alternatives: true
  
  viewport_specific_handling:
    - handle_responsive_differences: true
    - allow_mobile_variations: true

integration:
  reporting_reporting:
    attach_element_screenshots: true
    include_accessibility_report: true
    responsive_comparison: true
  
  wordpress_integration:
    use_wp_page_objects: true
    handle_theme_variations: true
    detect_plugin_elements: true
  
  accessibility_integration:
    run_axe_checks: true
    validate_aria_attributes: true
    check_color_contrast: false  # Handled in accessibility specs